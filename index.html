<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>goFlux: A user-friendly R package that helps you calculate GHG fluxes yourself, regardless of user experience ‚Ä¢ goFlux</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="goFlux: A user-friendly R package that helps you calculate GHG fluxes yourself, regardless of user experience">
<meta property="og:description" content='This package is meant to be "student proof", meaning that no extensive knowledge or experience is needed to import raw data into R, choose the best model to calculate fluxes (LM or HM), quality check the results objectively and obtain high quality flux estimates.
    The package contains a wide range of functions that lets the user import raw data from a variety of instruments (LI-COR, LGR, GAIA2TECH, Gasmet, PP-Systems and Picarro); calculate fluxes from a variety of GHG (CO2, CH4, N2O, CO, NH3 and H2O) with both linear (LM) and non-linear (HM) flux calculation methods; align instruments clocks after data import; identify measurements (start and end time); plot measurements for easy visual inspection; and quality check the measurements based on objective criteria.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">goFlux</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="goflux-a-user-friendly-way-to-calculate-ghg-fluxes-yourself-regardless-of-user-experience">goFlux: A user-friendly way to calculate GHG fluxes yourself, regardless of user experience<img src="reference/figures/goFlux.png" align="right" width="200"><a class="anchor" aria-label="anchor" href="#goflux-a-user-friendly-way-to-calculate-ghg-fluxes-yourself-regardless-of-user-experience"></a>
</h1></div>
<p>This document is out of date. Please consult <a href="https://qepanna.quarto.pub/goflux/" class="external-link">this webpage</a> instead.</p>
<div class="section level4">
<h4 id="first-release">FIRST RELEASE<a class="anchor" aria-label="anchor" href="#first-release"></a>
</h4>
<p>The package is ready to use and fully functional, but errors may still occur. Please report any issues to the maintainer, Karelle Rheault (<a href="mailto:karh@ign.ku.dk" class="email">karh@ign.ku.dk</a>), including script and raw data if necessary. Thank you for helping me in the development of this tool! üôè</p>
</div>
<div class="section level3">
<h3 id="one-package-to-rule-them-all">One Package to rule them all<a class="anchor" aria-label="anchor" href="#one-package-to-rule-them-all"></a>
</h3>
<p>Non-steady state chambers are widely used for measuring soil greenhouse gas (GHG) fluxes, such as CO<sub>2</sub>, CH<sub>4</sub>, N<sub>2</sub>O, NH<sub>3</sub>, CO, and water vapor (H<sub>2</sub>O). While linear regression (LM) is commonly used to estimate GHG fluxes, this method tends to underestimate the pre-deployment flux (<em>f</em><sub>0</sub>). Indeed, non-linearity is expected when the gas concentration increases or decreases inside a closed chamber, due to changes in gas gradients between the soil and the air inside the chamber. In addition, lateral gas flow and leakage contribute to non-linearity. Many alternative to LM have been developed to try and provide a more accurate estimation of <em>f</em><sub>0</sub>, for instance the method of <a href="https://doi.org/10.2136/sssaj1981.03615995004500020017x" class="external-link">Hutchinson and Mosier (HM) (1981)</a>, which was implemented in the <a href="https://cran.r-project.org/package=HMR" class="external-link"><code>HMR</code></a> package by <a href="https://doi.org/10.1111/j.1365-2389.2010.01291.x" class="external-link">Pedersen et al., 2010</a>. However, non-linear models have a tendency to largely overestimate some flux measurements, due to an exaggerated curvature. Therefore, the user is expected to decide which method is more appropriate for each flux estimate. With the advent of portable greenhouse gas analyzers (e.g.¬†<a href="https://new.abb.com/products/measurement-products/analytical/laser-gas-analyzers/laser-analyzers/lgr-icos-portable-analyzers" class="external-link">Los Gatos Research (ABB) laser gas analyzers</a>), soil GHG fluxes have become much easier to measure, and more efficient ways to calculate these flux estimates are needed in order to process large amounts of data. A recent approach was developed by <a href="https://doi.org/10.1371/journal.pone.0200876" class="external-link">H√ºppi et al., 2018</a> to restrict the curvature in the HM model for a more reliable flux estimate. In the HM model, the curvature is controlled by the kappa parameter. H√ºppi et al.¬†suggest the use of the kappa.max to limit the maximal curvature allowed in the model (see their R package <a href="https://cran.r-project.org/package=gasfluxes" class="external-link"><code>gasfluxes</code></a>, available on the CRAN). This procedure introduces less arbitrary decisions in the flux estimation process.</p>
<p>Previous software developed to calculate GHG fluxes are limited in many aspects that the goFlux package is meant to overcome. Most are limited to the linear regression approach (e.g.¬†<a href="https://www.sciencedirect.com/science/article/pii/S0168192319301522" class="external-link">Flux Puppy</a>, and the R packages <a href="https://cran.r-project.org/package=flux" class="external-link"><code>flux</code></a> and <a href="https://github.com/junbinzhao/FluxCalR" class="external-link"><code>FluxCalR</code></a>), others do not include data pre-processing (e.g.¬†the R packages <a href="https://cran.r-project.org/package=HMR" class="external-link"><code>HMR</code></a>, <a href="https://cran.r-project.org/package=flux" class="external-link"><code>flux</code></a> and <a href="https://cran.r-project.org/package=gasfluxes" class="external-link"><code>gasfluxes</code></a>), or if they do, they are compatible with only a few designated systems (e.g.¬†<a href="https://www.sciencedirect.com/science/article/pii/S0168192319301522" class="external-link">Flux Puppy</a> and <a href="https://github.com/junbinzhao/FluxCalR" class="external-link"><code>FluxCalR</code></a>), and almost none include an automatic selection of the best flux estimate (LM or HM) based on objective criteria.</p>
<p>This new R package, <code>goFlux</code> is meant to be ‚Äústudent proof‚Äù, meaning that no extensive knowledge or experience is needed to import raw data into R, choose the best model to calculate fluxes (LM or HM), quality check the results objectively and obtain high quality flux estimates. The package contains a wide range of functions that allows the user to import raw data from a variety of instruments (LI-COR, LGR, GAIA2TECH, Gasmet, Picarro and PP-Systems); calculate fluxes from a variety of GHG (CO<sub>2</sub>, CH<sub>4</sub>, N<sub>2</sub>O, NH<sub>3</sub>, CO and H<sub>2</sub>O) with both linear (LM) and non-linear (HM) flux calculation methods; align instruments clocks after data import; interactively identify measurements (start and end time) if there are no automatic chamber recordings (e.g.¬†LI-COR smart chamber); plot measurements for easy visual inspection; and quality check the measurements based on objective criteria.</p>
<blockquote>
<p><em>Three R packages for the Elven-kings under the CRAN,<br>
Seven for the Dwarf-lords in their halls of open software,<br>
Nine for Mortal Men doomed to write scripts themselves,<br>
One for the Dark Lady on her dark throne<br>
In the Land of GitHub where the Shadows lie.<br>
One Package to rule them all, One Package to find them,<br>
One Package to bring them all and in the darkness bind them<br>
In the Land of GitHub where the Shadows lie.</em></p>
</blockquote>
</div>
<div class="section level2">
<h2 id="about-the-package">About the package<a class="anchor" aria-label="anchor" href="#about-the-package"></a>
</h2>
<p>This package <code>goFlux</code> is meant to be ‚Äústudent proof‚Äù, meaning that no extensive knowledge or experience is needed to import raw data into R (except for knowing how to use R, of course), choose the best model to calculate fluxes (LM or HM, that is the question. -Shakespeare, 1603), quality check the results objectively (hence the no experience needed) and obtain high quality flux estimates from static chamber measurements (wonderful!).</p>
<div class="section level3">
<h3 id="import-and-measurement-identification">Import and measurement identification<a class="anchor" aria-label="anchor" href="#import-and-measurement-identification"></a>
</h3>
<p>The package contains a wide range of functions that let the user import raw data from a variety of instruments:</p>
<ul>
<li>
<a href="https://www.licor.com/env/products/trace-gas/" class="external-link"><strong>LI-COR trace gas analyzers</strong></a>: LI-6400 for CO<sub>2</sub> and H<sub>2</sub>O, LI-7810 for CO<sub>2</sub>, CH<sub>4</sub> and H<sub>2</sub>O, LI-7820 for N<sub>2</sub>O and H<sub>2</sub>O, and LI-8100 for CO<sub>2</sub> and H<sub>2</sub>O</li>
<li>
<a href="https://www.licor.com/env/products/soil-flux/survey" class="external-link"><strong>LI-COR Smart Chamber</strong></a>: for an easy import of data from any gas analyzer</li>
<li>
<a href="https://new.abb.com/products/measurement-products/analytical/laser-gas-analyzers/laser-analyzers/lgr-icos-portable-analyzers" class="external-link"><strong>Los Gatos Research (ABB) laser gas analyzers</strong></a>: Ultra-portable Greenhouse Gas Analyzer (GLA132-UGGA) and Microportable Greenhouse Gas Analyzer (GLA131-MGGA) for CO<sub>2</sub>, CH<sub>4</sub> and H<sub>2</sub>O, and GLA151-N2OM1 for N<sub>2</sub>O, CH<sub>4</sub> and H<sub>2</sub>O</li>
<li>
<a href="https://www.picarro.com/g2508_gas_concentration_analyzer" class="external-link"><strong>Picarro G2508 Gas Concentration Analyzer</strong></a>: for CO<sub>2</sub>, CH<sub>4</sub>, N<sub>2</sub>O, NH<sub>3</sub> and H<sub>2</sub>O</li>
<li>
<a href="https://www.picarro.com/products/gas-scouter-g4301" class="external-link"><strong>Picarro GasScouter<sup>TM</sup> G4301 Mobile Gas Concentration Analyzer</strong></a>: for CO<sub>2</sub>, CH<sub>4</sub> and H<sub>2</sub>O</li>
<li>
<a href="https://www.dmr.eu/technologies/gas-emission-measurements-eco2flux/automated-eco2flux-chamber/" class="external-link"><strong>GAIATECH Automated ECOFlux chamber</strong></a>: for an easy import of data from any gas analyzer</li>
<li>
<a href="https://www.gasmet.com/products/category/portable-gas-analyzers/dx4015/" class="external-link"><strong>Gasmet DX4015 portable analyzer for humid conditions</strong></a>: for CO, CO<sub>2</sub>, CH<sub>4</sub>, N<sub>2</sub>O, NH<sub>3</sub> and H<sub>2</sub>O</li>
<li>
<a href="https://ppsystems.com/egm-5/" class="external-link"><strong>PP-Systems EGM-5 Portable CO<sub>2</sub> Gas Analyzer</strong></a>: for CO<sub>2</sub>, O<sub>2</sub> and H<sub>2</sub>O</li>
</ul>
<p>After import, the user can choose from two methods for identification of measurements:</p>
<ul>
<li>
<strong>Manual identification of measurements</strong> - based on <code>start.time</code>, provided separately in an auxiliary file. The function <code><a href="reference/obs.win.html">obs.win()</a></code> splits the imported data into a list of data frame (divided by <code>UniqueID</code>) and creates an observation window around the <code>start.time</code> to allow for a manual selection of the start and end points of each measurements, using the function <code><a href="reference/click.peak.loop.html">click.peak.loop()</a></code>.</li>
<li>
<strong>Automatic selection of measurements</strong> - based on automatic recordings of chamber opening and closing from an instrument such as the LI-COR Smart Chamber or the GAIATECH Automated ECOFlux chamber.</li>
</ul>
</div>
<div class="section level3">
<h3 id="flux-calculation">Flux calculation<a class="anchor" aria-label="anchor" href="#flux-calculation"></a>
</h3>
<p>The function <code><a href="reference/goFlux.html">goFlux()</a></code> calculates fluxes from a variety of greenhouse gases (CO<sub>2</sub>, CH<sub>4</sub>, N<sub>2</sub>O, NH<sub>3</sub>, CO, and H<sub>2</sub>O) using both linear (LM) and non-linear (HM; <a href="https://doi.org/10.2136/sssaj1981.03615995004500020017x" class="external-link">Hutchinson and Mosier, 1981</a>) flux calculation methods. The HM model for the chamber concentration <span class="math inline"><em>C</em><sub><em>t</em></sub></span> at time <span class="math inline"><em>t</em>‚ÄÑ&gt;‚ÄÑ0</span> after deployment is given by:</p>
<p><span class="math display"><strong>E</strong><strong>q</strong><strong>n</strong>¬†<strong>1</strong>¬†¬†¬†¬†¬†¬†<em>C</em><sub><em>t</em></sub>‚ÄÑ=‚ÄÑ<em>œÜ</em>¬†+¬†(<em>C</em><sub>0</sub>‚àí<em>œÜ</em>)<em>e</em><sup>‚àí¬†<em>Œ∫</em>¬†<em>t</em></sup></span></p>
<p>Where <span class="math inline"><em>œÜ</em></span> is the assumed concentration of constant gas source below the surface (also known as <span class="math inline"><em>C</em><sub><em>i</em></sub></span>), <span class="math inline"><em>C</em><sub>0</sub></span> is the concentration in the chamber at the moment of chamber closure and <span class="math inline"><em>Œ∫</em></span> (kappa) determines the curvature of the model. A large kappa returns a strong curvature.</p>
<p>A maximum threshold for this parameter, kappa-max (<span class="math inline"><em>k</em>.<em>m</em><em>a</em><em>x</em></span>), can be calculated from the linear flux estimate (<span class="math inline"><em>L</em><em>M</em>.<em>f</em><em>l</em><em>u</em><em>x</em></span>), the minimal detectable flux (<span class="math inline"><em>M</em><em>D</em><em>F</em></span>) and the time of chamber closure (<span class="math inline"><em>t</em></span>) (<a href="https://doi.org/10.1371/journal.pone.0200876" class="external-link">H√ºppi et al., 2018</a>).</p>
<p><span class="math display">$$\mathbf{Eqn~2}~~~~~~k.max = \frac{LM.flux}{MDF~\times~t}$$</span></p>
<p>Where <span class="math inline"><em>L</em><em>M</em>.<em>f</em><em>l</em><em>u</em><em>x</em></span> and <span class="math inline"><em>M</em><em>D</em><em>F</em></span> have the same units (nmol or ¬µmol¬∑m<sup>-2</sup>¬∑s<sup>-1</sup>) and <span class="math inline"><em>t</em></span> is in seconds. Therefore, the units of kappa-max is s<sup>-1</sup>. This limit of kappa-max is included in the <code><a href="reference/goFlux.html">goFlux()</a></code> function, so that the non-linear flux estimate cannot exceed this maximum curvature. See below for more details about the minimal detectable flux (MDF).</p>
<p>All flux estimates, including the MDF, are multiplied by a <span class="math inline"><em>f</em><em>l</em><em>u</em><em>x</em>.<em>t</em><em>e</em><em>r</em><em>m</em></span> which is used to correct for water vapor inside the chamber, as well as convert the units to obtain a term in nmol or ¬µmol¬∑m<sup>-2</sup>¬∑s<sup>-1</sup>:</p>
<p><span class="math display">$$\mathbf{Eqn~3}~~~~~~flux.term = \frac{(1 - H_2O)~V~P}{A~R~T}$$</span></p>
<p>Where <span class="math inline"><em>H</em><sub>2</sub><em>O</em></span> is the water vapor in mol¬∑mol<sup>-1</sup>, <span class="math inline"><em>V</em></span> is the volume inside the chamber in liters, <span class="math inline"><em>P</em></span> is the pressure in kPa, <span class="math inline"><em>A</em></span> is the surface area inside the chamber in m<sup>2</sup>, <span class="math inline"><em>R</em></span> is the universal gas constant in L¬∑kPa¬∑K<sup>-1</sup>¬∑mol<sup>-1</sup>. Each parameters are measured inside the chamber at <span class="math inline"><em>t</em>‚ÄÑ=‚ÄÑ0</span>.</p>
</div>
<div class="section level3">
<h3 id="automatic-selection-of-the-best-flux-estimate">Automatic selection of the best flux estimate<a class="anchor" aria-label="anchor" href="#automatic-selection-of-the-best-flux-estimate"></a>
</h3>
<p>Following flux calculation, the user can select the best flux estimate (LM or HM) based on objective criteria, using the <code><a href="reference/best.flux.html">best.flux()</a></code> function:</p>
<ul>
<li>
<strong>Assumed non-linearity</strong>: If all criteria are met, the best flux estimate is assumed to be the non-linear estimate from the Hutchinson and Mosier model.</li>
<li>
<strong>G-factor</strong>: the ratio between a non-linear flux estimate (e.g.¬†Hutchinson and Mosier; HM) and a linear flux estimate.</li>
<li>
<strong>Kappa ratio</strong>: maximal limit of the ratio between kappa and kappa-max (<span class="math inline"><em>k</em>.<em>m</em><em>a</em><em>x</em></span>).</li>
<li>
<strong>Indices of model fit</strong>: the best model can be selected based on a selection of indices of model fit: MAE, RMSE, SE and AICc. In addition to the automatic selection of the best flux estimate based on these indices of model fit, measurements can be flagged ‚Äúnoisy‚Äù using these criteria.</li>
</ul>
<p>In addition, the <code><a href="reference/best.flux.html">best.flux()</a></code> function can flag measurements that are below detection limit (MDF and <em>p-value</em>), out of bounds (intercept), or too short (number of observations).</p>
<ul>
<li>
<strong>Minimal Detectable Flux (MDF)</strong>: limit under which a flux estimate is considered below the detection limit.</li>
<li>
<strong>Statistically significant flux (<em>p-value</em>)</strong>: limit under which a flux estimate is considered statistically non-significant, and below the detection limit.</li>
<li>
<strong>Intercept</strong>: inferior and superior limits of the intercept (initial concentration; <span class="math inline"><em>C</em><sub>0</sub></span>).</li>
<li>
<strong>Number of observations</strong>: limit under which a measurement is flagged for being too short.</li>
</ul>
<p>By default, all criteria are included: <code>criteria = c("MAE", "RMSE", "AICc", "SE", "g-factor", "kappa", "MDF", "nb.obs", "p-value", "intercept")</code></p>
<div class="section level4">
<h4 id="g-factor">
<strong>G-factor</strong><a class="anchor" aria-label="anchor" href="#g-factor"></a>
</h4>
<p>The g-factor is the ratio between a non-linear flux estimate (e.g.¬†Hutchinson and Mosier; HM) and a linear flux estimate (<a href="https://doi.org/10.1371/journal.pone.0200876" class="external-link">H√ºppi et al., 2018</a>).</p>
<p><span class="math display">$$\mathbf{Eqn~4}~~~~~~g-factor = \frac{HM.flux}{LM.flux}$$</span></p>
<p>With the <code><a href="reference/best.flux.html">best.flux()</a></code> function, one can choose a limit at which the HM model is deemed to overestimate (<em>f</em><sub>0</sub>). Recommended thresholds for the g-factor are &lt;4 for a flexible threshold, &lt;2 for a medium threshold, or &lt;1.25 for a more conservative threshold. The default threshold is <code>g.limit = 2</code>. If the g-factor is above the specified threshold, the best flux estimate will switch to LM instead of HM. If <code>HM.flux/LM.flux</code> is larger than <code>g.limit</code>, a warning is given in the columns <code>HM.diagnose</code> and <code>quality.check</code>.</p>
</div>
<div class="section level4">
<h4 id="minimal-detectable-flux-mdf">
<strong>Minimal Detectable Flux (MDF)</strong><a class="anchor" aria-label="anchor" href="#minimal-detectable-flux-mdf"></a>
</h4>
<p>The minimal detectable flux (<span class="math inline"><em>M</em><em>D</em><em>F</em></span>) is based on instrument precision (<span class="math inline"><em>p</em><em>r</em><em>e</em><em>c</em></span>) and measurement time (<span class="math inline"><em>t</em></span>) (<a href="https://doi.org/10.1016/j.agrformet.2015.06.004" class="external-link">Christiansen et al., 2015</a>).</p>
<p><span class="math display">$$\mathbf{Eqn~5}~~~~~~MDF = \frac{prec}{t}~\times~flux.term$$</span></p>
<p>Where the instrument precision is in the same units as the measured gas (ppm or ppb) and the measurement time is in seconds.</p>
<p>Below the MDF, the flux estimate is considered under the detection limit, but not null. Therefore, the function will not return a 0. There will simply be a warning in the columns <code>quality.check</code>, <code>LM.diagnose</code> or <code>HM.diagnose</code> to warn of a flux estimate under the detectable limit. No best flux estimate is chosen based on MDF.</p>
</div>
<div class="section level4">
<h4 id="kappa-ratio">
<strong>Kappa ratio</strong><a class="anchor" aria-label="anchor" href="#kappa-ratio"></a>
</h4>
<p>The parameter kappa determines the curvature of the non-linear regression in the Hutchinson and Mosier model, as shown in equation 1. The limit of kappa-max, as calculated in equation 2, is included in the <code><a href="reference/goFlux.html">goFlux()</a></code> function, so that the non-linear flux estimate cannot exceed this maximum curvature.</p>
<p>In the function <code><a href="reference/best.flux.html">best.flux()</a></code>, one can choose the linear flux estimate over the non-linear flux estimate based on the ratio between kappa and kappa-max (<code>k.ratio</code>). A value of 1 indicates <code>HM.k = k.max</code>, and a value of e.g.¬†0.5 indicates <code>HM.k = 0.5*k.max</code>. The default setting is <code>k.ratio = 1</code>. If <code>HM.k/k.max</code> is larger than <code>k.ratio</code>, a warning is issued in the columns <code>HM.diagnose</code> and <code>quality.check</code>. The ratio is expressed as a percentage of kappa-max in the plots.</p>
</div>
<div class="section level4">
<h4 id="indices-of-model-fit">
<strong>Indices of model fit</strong><a class="anchor" aria-label="anchor" href="#indices-of-model-fit"></a>
</h4>
<p>In the <code><a href="reference/best.flux.html">best.flux()</a></code> function, we included multiple choices of indices of model fit, described below. One can choose to include however many of them in the function. If multiple of them are included, the selection of the best model will be made based on a scoring system. Both models start with a score of 0. For each criteria, whichever model performs worst is given +1. After all selected criteria have been evaluated, the model with the lowest score wins. In case of a tie, the non-linear flux estimate is always chosen by default, as non-linearity is assumed.</p>
<div class="section level5">
<h5 id="mean-absolute-error-mae-and-root-mean-square-error-rmse">
<strong>Mean Absolute Error (MAE) and Root Mean Square Error (RMSE)</strong><a class="anchor" aria-label="anchor" href="#mean-absolute-error-mae-and-root-mean-square-error-rmse"></a>
</h5>
<p>The mean absolute error (MAE) is the arithmetic mean of the absolute residuals of a model, calculated as follows:</p>
<p><span class="math display">$$
\mathbf{Eqn~6}~~~~~~MAE = \frac{1}{n} \sum_{i = 1}^{n}{\lvert{y_i-\hat{y_i}}\rvert}
$$</span></p>
<p>Where <span class="math inline"><em>y</em><sub><em>i</em></sub></span> is the measured value, <span class="math inline">$\hat{y_i}$</span> is the predicted value and <span class="math inline"><em>n</em></span> is the number of observations.</p>
<p>The root mean square error (RMSE) is very similar to the MAE. Instead of using absolute errors, it uses squared errors, and the mean of the squared errors is then rooted as follows:</p>
<p><span class="math display">$$
\mathbf{Eqn~7}~~~~~~RMSE = \sqrt{\frac{1}{n} \sum_{i = 1}^{n}{({y_i-\hat{y_i}})^2}}
$$</span></p>
<p>Because of the squared errors, RMSE is sensitive to outliers. Indeed, a few large errors will have a significant impact on the RMSE. Therefore, RMSE will always be larger than or equal to MAE (<a href="https://doi.org/10.1007/s10651-007-0043-y" class="external-link">Pontius et al., 2008</a>).</p>
<p>Mathematically, RMSE is equivalent to the standard deviation of the residuals. Indeed, for a constant gas concentration, the standard deviation is expressed as follows:</p>
<p><span class="math display">$$
\mathbf{Eqn~8}~~~~~~\sigma = \sqrt{\frac{1}{N} \sum_{i = 1}^{N}{({x_i-\mu})^2}}
$$</span></p>
<p>Where <span class="math inline"><em>x</em><sub><em>i</em></sub></span> is the measured value, <span class="math inline"><em>N</em></span> is the size of the population and <span class="math inline"><em>Œº</em></span> is the population mean. The standard deviation is used to calculate the precision of an instrument. In that case, <span class="math inline"><em>Œº</em></span> is a known constant gas concentration and <span class="math inline"><em>N</em></span> is the number of observations.</p>
<p>Considering all of the above, MAE, RMSE and the standard deviation are all measures of how much the data points are scattered around the true mean or the regression. Therefore, MAE and RMSE can be compared to the instrument precision to determine if a measurement is noisy. For a MAE or RMSE larger than the instrument precision, the measurement is considered to have more noise than normally expected.</p>
<p>If MAE is chosen as a criteria in <code><a href="reference/best.flux.html">best.flux()</a></code>, the model with the smallest MAE is chosen. If both models have a MAE smaller than the instrument precision, the non-linear flux estimate is always chosen by default, as non-linearity is assumed. When MAE is larger than the instrument precision, a warning is given in the columns <code>quality.check</code>, <code>LM.diagnose</code> or <code>HM.diagnose</code> to warn of a noisy measurement. RMSE functions exactly the same was as MAE in the <code><a href="reference/best.flux.html">best.flux()</a></code> function.</p>
</div>
<div class="section level5">
<h5 id="standard-error">
<strong>Standard Error</strong><a class="anchor" aria-label="anchor" href="#standard-error"></a>
</h5>
<p>While the standard deviation describes how the data points are scattered around the true mean, the standard error of a measurement tells how accurate that measurement is compared to the true population mean (<a href="https://doi.org/10.1136%2Fbmj.331.7521.903" class="external-link">Altman and Bland, 2005</a>). If considering the standard deviation as used to calculate instrument precision (equation 8), the instrument standard error (instrument accuracy) can be defined as the standard deviation divided by the square root of the number of observations:</p>
<p><span class="math display">$$\mathbf{Eqn~9}~~~~~~\sigma_\bar{x} = \frac{\sigma}{\sqrt{n}}$$</span></p>
<p>Practically, this means that the accuracy increases with the sample size of a measurement. In other words, if an instrument is imprecise and the measurement has a lot of noise, it is still possible to get a more accurate estimate of the true mean by increasing the number of observations. With high-frequency GHG analyzers, that means increasing the chamber closure time.</p>
<p>To calculate the standard error of a regression, one can use the delta method (<code>deltamethod()</code> from the <code>msm</code> package), which propagates the total error of the flux calculation for each parameter included in the formula. The delta method approximates the standard error of a regression <span class="math inline"><em>g</em>(<em>X</em>)</span> of a random variable <span class="math inline"><em>X</em>‚ÄÑ=‚ÄÑ(<em>x</em><sub>1</sub>,<em>x</em><sub>2</sub>,...)</span>, given estimates of the mean and covariance matrix of <span class="math inline"><em>X</em></span> (<a href="https://doi.org/10.2307/2684406" class="external-link">Oehlert, 1992</a>; <a href="https://doi.org/10.1080/00031305.2013.783880" class="external-link">Mandel, 2013</a>).</p>
<p>In the function <code><a href="reference/best.flux.html">best.flux()</a></code>, the standard error (SE) of the measurements can be compared to the standard error of the instrument (<span class="math inline"><em>œÉ</em><sub><em>xÃÑ</em></sub></span>). If SE is chosen as a criteria in <code><a href="reference/best.flux.html">best.flux()</a></code>, the model with the smallest SE is chosen. If both models have a SE smaller than the instrument precision, the non-linear flux estimate is always chosen by default, as non-linearity is assumed. When SE is larger than the instrument accuracy (<span class="math inline"><em>œÉ</em><sub><em>xÃÑ</em></sub></span>), a warning is given in the columns <code>quality.check</code>, <code>LM.diagnose</code> or <code>HM.diagnose</code> to warn of a noisy measurement.</p>
</div>
<div class="section level5">
<h5 id="akaike-information-criterion-corrected-for-small-sample-size-aicc">
<strong>Akaike Information Criterion corrected for small sample size (AICc)</strong><a class="anchor" aria-label="anchor" href="#akaike-information-criterion-corrected-for-small-sample-size-aicc"></a>
</h5>
<p>The AIC estimates the relative quality of a statistical model and is used to compare the fitting of different models to a set of data (<a href="https://doi.org/10.1109/TAC.1974.1100705" class="external-link">Akaike, 1974</a>). Consider the formula for AIC:</p>
<p><span class="math display"><strong>E</strong><strong>q</strong><strong>n</strong>¬†<strong>10</strong>¬†¬†¬†¬†¬†¬†<em>A</em><em>I</em><em>C</em>‚ÄÑ=‚ÄÑ2<em>k</em>‚ÄÖ‚àí‚ÄÖ2<em>l</em><em>n</em>(<em>LÃÇ</em>)</span></p>
<p>Where <span class="math inline"><em>k</em></span> is the number of parameters in the model and <span class="math inline"><em>LÃÇ</em></span> is the maximized value of the likelihood function for the model. AIC deals with the trade-off between the goodness of fit of a model and the simplicity of the model. In other words, the AIC is a score that deals with both the risk of underfitting and the risk of overfitting, and the model with the lowest score has the best model fit.</p>
<p>In flux calculation, the linear model contains two parameters: the slope and the intercept (<span class="math inline"><em>C</em><sub>0</sub></span>), whereas the Hutchinson and Mosier model (equation 1) contains three parameters: the assumed concentration of constant gas source below the surface (<span class="math inline"><em>œÜ</em></span>), the concentration in the chamber at the moment of chamber closure (<span class="math inline"><em>C</em><sub>0</sub></span>) and the curvature, kappa (<span class="math inline"><em>Œ∫</em></span>). If both models have a very similar fit (maximum likelihood), then the linear model would win because it has less parameters. However, when the sample size is small (&lt;40 observations per parameter; i.e.¬†&lt;120 observations when calculating HM), there is an increased risk that AIC selects a model with too many parameters. To address this risk of overfitting, AICc was developed (<a href="https://doi.org/10.1080/03610927808827599" class="external-link">Sugiura, 1978</a>):</p>
<p><span class="math display">$$\mathbf{Eqn~11}~~~~~~AICc = AIC + \frac{2k^2 + 2k}{n - k - 1}$$</span></p>
<p>Where <span class="math inline"><em>n</em></span> denotes the number of observations and <span class="math inline"><em>k</em></span> the number of parameters in the model.</p>
<p>If AICc is selected as a criteria in the <code><a href="reference/best.flux.html">best.flux()</a></code> function, the model with the lowest AICc wins.</p>
</div>
</div>
<div class="section level4">
<h4 id="intercept">
<strong>Intercept</strong><a class="anchor" aria-label="anchor" href="#intercept"></a>
</h4>
<p>If the initial gas concentration (<em>C<sub>0</sub></em>) calculated for the flux estimates (<code>HM.C0</code> and <code>LM.C0</code>) deviates from the true <em>C<sub>0</sub></em> (measured concentration at <span class="math inline"><em>t</em>‚ÄÑ=‚ÄÑ0</span>) by more or less than 10% of the difference between <em>C<sub>0</sub></em> and the final gas concentration at the end of the measurement (<em>C<sub>t</sub></em>), a warning is issued in the columns <code>quality.check</code>, <code>LM.diagnose</code> or <code>HM.diagnose</code> to warn of an intercept out of bounds. Alternatively, one can provide boundaries for the intercept, for example: <code>intercept.lim = c(380, 420)</code> for a true <em>C<sub>0</sub></em> of 400 ppm.</p>
</div>
<div class="section level4">
<h4 id="statistically-significant-flux-p-value">
<strong>Statistically significant flux (<em>p-value</em>)</strong><a class="anchor" aria-label="anchor" href="#statistically-significant-flux-p-value"></a>
</h4>
<p>This criteria is only applicable to the linear flux. Under a defined <em>p-value</em>, the linear flux estimate is deemed non-significant, i. e., flux under the detectable limit. The default threshold is <code>p.val = 0.05</code>. No best flux estimate is chosen based on <em>p-value</em>. If <code>LM.p.val &lt; p.val</code>, a warning is given in the columns <code>quality.check</code> and <code>LM.diagnose</code> to warn of an estimated flux under the detection limit.</p>
</div>
<div class="section level4">
<h4 id="number-of-observations">
<strong>Number of observations</strong><a class="anchor" aria-label="anchor" href="#number-of-observations"></a>
</h4>
<p>Limit under which a measurement is flagged for being too short (<code>nb.obs &lt; warn.length</code>). With nowadays‚Äô portable greenhouse gas analyzers, the frequency of measurement is usually one observation per second. Therefore, for the default setting of <code>warn.length = 60</code>, the chamber closure time should be approximately one minute (60 seconds). If the number of observations is smaller than the threshold, a warning is issued in the column <code>quality.check</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="visual-inspection">Visual inspection<a class="anchor" aria-label="anchor" href="#visual-inspection"></a>
</h3>
<p>Finally, after finding the best flux estimates, one can plot the results and visually inspect the measurements using the function <code><a href="reference/flux.plot.html">flux.plot()</a></code> and save the plots as pdf using <code><a href="reference/flux2pdf.html">flux2pdf()</a></code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="how-to-use">How to use<a class="anchor" aria-label="anchor" href="#how-to-use"></a>
</h2>
<p>Here is a simple example on how to use the package with a single raw file from LGR gas analyzers.</p>
<blockquote>
<p>FIRST RELEASE</p>
<p>The package is ready to use and fully functional, but errors may still occur. Please report any issues to the maintainer, Karelle Rheault (<a href="mailto:karh@ign.ku.dk" class="email">karh@ign.ku.dk</a>), including script and raw data if necessary. Thank you for helping me in the development of this tool! üôè</p>
</blockquote>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>To install a package from GitHub, one must first install the package <code>remotes</code> from the CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://remotes.r-lib.org" class="external-link">"remotes"</a></span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span></code></pre></div>
<p>Then, install the <code>goFlux</code> package from GitHub. If it is not the first time you install the package, it must first be detached before being updated.</p>
<blockquote>
<p>The package is actively being updated <strong>every day</strong>. To make sure that you are using the latest version, re-install the package every time you use it.</p>
</blockquote>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/detach.html" class="external-link">detach</a></span><span class="op">(</span><span class="st">"package:goFlux"</span>, unload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Qepanna/goFlux"</span><span class="op">)</span></span></code></pre></div>
<p><strong>If prompted, it is recommended to update any pre-installed packages.</strong> The functioning of the package depends on many other packages (<code>AICcmodavg</code>, <code>data.table</code>, <code>dplyr</code>, <code>ggnewscale</code>, <code>ggplot2</code>, <code>ggstar</code>, <code>graphics</code>, <code>grDevices</code>, <code>grid</code>, <code>gridExtra</code>, <code>lubridate</code>, <code>minpack.lm</code>, <code>msm</code>, <code>pbapply</code>, <code>plyr</code>, <code>purrr</code>, <code>rjson</code>, <code>rlist</code>, <code>SimDesign</code>, <code>stats</code>, <code>stringr</code>, <code>tibble</code>, <code>tidyr</code>, <code>utils</code>), which will be installed when installing <code>goFlux</code>.</p>
<p>Troubleshoot problems with <code>install_github()</code>:</p>
<ul>
<li><a href="#warning-package-is-in-use-and-will-not-be-installed">Warning: package is in use and will not be installed</a></li>
<li><a href="#error-api-rate-limit-exceeded">Error: API rate limit exceeded</a></li>
</ul>
</div>
<div class="section level3">
<h3 id="import-raw-data-into-r">Import raw data into R<a class="anchor" aria-label="anchor" href="#import-raw-data-into-r"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">goFlux</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get the example raw file from the package</span></span>
<span><span class="va">file.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"LGR/LGR.txt"</span>, package <span class="op">=</span> <span class="st">"goFlux"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import raw data from an LGR gas analyzer</span></span>
<span><span class="op">?</span><span class="va">LGR_import</span></span>
<span><span class="va">LGR_imp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/LGR_import.html">LGR_import</a></span><span class="op">(</span>inputfile <span class="op">=</span> <span class="va">file.path</span><span class="op">)</span></span></code></pre></div>
<p>Note that raw data can also be imported from a multitude of other instruments, and example data files are provided for all of them:</p>
<ul>
<li>LI-COR: LI-6400, LI-7810, LI-7820, LI-8100, LI-8200 (smart chamber)</li>
<li>Los Gatos Research instruments: GLA131-MGGA, GLA132-UGGA and GLA151-N2OM1</li>
<li>GAIA2TECH (DMR) automated chamber ECOFlux</li>
<li>Picarro: G2508 and G4301</li>
<li>Gasmet: DX4015</li>
<li>PP-Systems: EGM-5</li>
</ul>
<p>To import multiple files from a folder, use the wrapper function <code><a href="reference/import2RData.html">import2RData()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get help for import functions from the goFlux package</span></span>
<span><span class="op">?</span><span class="va">DX4015_import</span></span>
<span><span class="op">?</span><span class="va">EGM5_import</span></span>
<span><span class="op">?</span><span class="va">G2508_import</span></span>
<span><span class="op">?</span><span class="va">G4301_import</span></span>
<span><span class="op">?</span><span class="va">GAIA_import</span></span>
<span><span class="op">?</span><span class="va">LI6400_import</span></span>
<span><span class="op">?</span><span class="va">LI7810_import</span></span>
<span><span class="op">?</span><span class="va">LI7820_import</span></span>
<span><span class="op">?</span><span class="va">LI8100_import</span></span>
<span><span class="op">?</span><span class="va">LI8200_import</span></span>
<span><span class="op">?</span><span class="va">N2OM1_import</span></span>
<span><span class="op">?</span><span class="va">import2RData</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="manual-identification-of-measurements">Manual identification of measurements<a class="anchor" aria-label="anchor" href="#manual-identification-of-measurements"></a>
</h3>
<p>In this example, the <code>start.time</code> for each measurement (<code>UniqueID</code>) was noted manually in the field, and are provided in an auxiliary file (<code>LGR_aux.txt</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Other usefull packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The auxfile requires start.time and UniqueID</span></span>
<span><span class="co"># start.time must be in the format "%Y-%m-%d %H:%M:%S"</span></span>
<span><span class="va">aux.path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"LGR/LGR_aux.txt"</span>, package <span class="op">=</span> <span class="st">"goFlux"</span><span class="op">)</span></span>
<span><span class="va">auxfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="va">aux.path</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>start.time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">start.time</span>, tz <span class="op">=</span> <span class="st">"UTC"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>When running the function <code><a href="reference/click.peak.html">click.peak()</a></code>, for each measurement, a window will open, in which you must click on the start point and the end point. The observation window is based on the <code>start.time</code> given in the <code>auxfile</code>, the length of the measurement (<code>obs.length</code>), and a <code>shoulder</code> before <code>start.time</code> and after <code>start.time + obs.length</code>. In this example, the observation time is 3 minutes (180 seconds) and the shoulder is 30 seconds. Therefore, the observation window shows 30 seconds before the <code>start.time</code> and 210 seconds after.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">obs.win</span></span>
<span></span>
<span><span class="co"># Define the measurements' window of observation</span></span>
<span><span class="va">LGR_ow</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/obs.win.html">obs.win</a></span><span class="op">(</span>inputfile <span class="op">=</span> <span class="va">LGR_imp</span>, auxfile <span class="op">=</span> <span class="va">auxfile</span>,</span>
<span>                  obs.length <span class="op">=</span> <span class="fl">180</span>, shoulder <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/click.peak1.png"></p>
<p>Pay attention to the warning message given by <code><a href="reference/obs.win.html">obs.win()</a></code> when there are more than 20 measurements (which is not the case in this example).</p>
<p>Note that for more than one gas measurement, it is better to use the function <code><a href="reference/click.peak.loop.html">click.peak.loop()</a></code> with <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> rather than using <code><a href="reference/click.peak.html">click.peak()</a></code> for each measurement individually.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">click.peak</span></span>
<span><span class="op">?</span><span class="va">click.peak.loop</span></span>
<span></span>
<span><span class="co"># Manually identify measurements by clicking on the start and end points</span></span>
<span><span class="va">LGR_manID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">LGR_ow</span><span class="op">)</span>, <span class="va">click.peak.loop</span>, flux.unique <span class="op">=</span> <span class="va">LGR_ow</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If the number of observation is under a certain threshold (<code>warn.length = 60</code>), a warning will be given after clicking on the start and end points as such:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning message: Number of observations for UniqueID: 733_C_C is 59 observations</span></span></code></pre></div>
<p>Otherwise, if the number of observation satisfies this threshold, then the following message is given instead:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Good window of observation for UniqueID: 733a_C_C</span></span></code></pre></div>
<p>Between each measurement, the result of the <code><a href="reference/click.peak.html">click.peak()</a></code> function is displayed for 3 seconds. To increase this delay, change the parameter <code>sleep</code> in the function <code><a href="reference/click.peak.loop.html">click.peak.loop()</a></code>.</p>
<p><img src="reference/figures/click.peak2.png"></p>
<p>To convert the flux estimate‚Äôs units into nmol CO<sub>2</sub>/H<sub>2</sub>O m<sup>-2</sup>s<sup>-1</sup> or ¬µmol CH<sub>4</sub>/N<sub>2</sub>O m<sup>-2</sup>s<sup>-1</sup>, the temperature inside the chamber (<code>Tcham</code>; ¬∞C) and the atmospheric pressure inside the chamber (<code>Pcham</code>; kPa) are also required. If <code>Pcham</code> and <code>Tcham</code> are missing, normal atmospheric pressure (101.325 kPa) and an air temperature of 15 ¬∞C are used as default.</p>
<p>Additionally, one must provide the surface area inside the chamber (<code>Area</code>; cm<sup>2</sup>) and the total volume in the system, including tubing, instruments and chamber (<code>Vtot</code>; L). If <code>Vtot</code> is missing, one must provide an offset (distance between the chamber and the soil surface; cm) and the volume of the chamber (<code>Vcham</code>; L). In that case, the volume inside the tubing and the instruments is considered negligible, or it should be added to <code>Vcham</code>.</p>
<p>The final output, before flux calculation with <code><a href="reference/goFlux.html">goFlux()</a></code> requires the columns: <code>UniqueID</code>, <code>Etime</code>, <code>flag</code>, <code>Vtot</code> (or <code>Vcham</code> and <code>offset</code>), <code>Area</code>, <code>Pcham</code>, <code>Tcham</code>, <code>H2O_ppm</code> and other gases.</p>
</div>
<div class="section level3">
<h3 id="flux-calculation-1">Flux calculation<a class="anchor" aria-label="anchor" href="#flux-calculation-1"></a>
</h3>
<p>The hardest part is now behind you. All that‚Äôs left is to run the flux calculation with the <code><a href="reference/goFlux.html">goFlux()</a></code> function for each gas. Then use the <code><a href="reference/best.flux.html">best.flux()</a></code> function to select the best flux estimates (LM or HM) for each gas based on your choice of criteria, and plot the results for visual inspection.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Flux calculation -------------------------------------------------------------</span></span>
<span><span class="op">?</span><span class="va">goFlux</span></span>
<span><span class="op">?</span><span class="va">best.flux</span></span>
<span></span>
<span><span class="co"># Calculate fluxes for all gas types</span></span>
<span><span class="va">CO2_flux</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/goFlux.html">goFlux</a></span><span class="op">(</span><span class="va">LGR_manID</span>, <span class="st">"CO2dry_ppm"</span><span class="op">)</span></span>
<span><span class="va">CH4_flux</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/goFlux.html">goFlux</a></span><span class="op">(</span><span class="va">LGR_manID</span>, <span class="st">"CH4dry_ppb"</span><span class="op">)</span></span>
<span><span class="va">H2O_flux</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/goFlux.html">goFlux</a></span><span class="op">(</span><span class="va">LGR_manID</span>, <span class="st">"H2O_ppm"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use best.flux to select the best flux estimates (LM or HM)</span></span>
<span><span class="co"># based on a list of criteria</span></span>
<span><span class="va">CO2_flux_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/best.flux.html">best.flux</a></span><span class="op">(</span><span class="va">CO2_flux</span>, criteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAE"</span>, <span class="st">"g.factor"</span>, <span class="st">"MDF"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">CH4_flux_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/best.flux.html">best.flux</a></span><span class="op">(</span><span class="va">CH4_flux</span>, criteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAE"</span>, <span class="st">"g.factor"</span>, <span class="st">"MDF"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">H2O_flux_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/best.flux.html">best.flux</a></span><span class="op">(</span><span class="va">H2O_flux</span>, criteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAE"</span>, <span class="st">"AICc"</span>, <span class="st">"MDF"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plots results ----------------------------------------------------------------</span></span>
<span><span class="op">?</span><span class="va">flux.plot</span></span>
<span><span class="op">?</span><span class="va">flux2pdf</span></span>
<span></span>
<span><span class="co"># Make a list of plots of all measurements, for each gastype.</span></span>
<span><span class="co"># With the function flux.plot, all parameters can be displayed.</span></span>
<span><span class="co"># You can choose what parameters to display on the plots.</span></span>
<span><span class="va">plot.legend</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MAE"</span>, <span class="st">"RMSE"</span>, <span class="st">"AICc"</span>, <span class="st">"k.ratio"</span>, <span class="st">"g.factor"</span><span class="op">)</span></span>
<span><span class="va">plot.display</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MDF"</span>, <span class="st">"prec"</span>, <span class="st">"nb.obs"</span>, <span class="st">"flux.term"</span><span class="op">)</span></span>
<span><span class="va">quality.check</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="va">CO2_flux_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flux.plot.html">flux.plot</a></span><span class="op">(</span><span class="va">CO2_flux_res</span>, <span class="va">LGR_manID</span>, <span class="st">"CO2dry_ppm"</span>, shoulder<span class="op">=</span><span class="fl">20</span>,</span>
<span>                            <span class="va">plot.legend</span>, <span class="va">plot.display</span>, <span class="va">quality.check</span><span class="op">)</span></span>
<span><span class="va">CH4_flux_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flux.plot.html">flux.plot</a></span><span class="op">(</span><span class="va">CH4_flux_res</span>, <span class="va">LGR_manID</span>, <span class="st">"CH4dry_ppb"</span>, shoulder<span class="op">=</span><span class="fl">20</span>,</span>
<span>                            <span class="va">plot.legend</span>, <span class="va">plot.display</span>, <span class="va">quality.check</span><span class="op">)</span></span>
<span><span class="va">H2O_flux_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flux.plot.html">flux.plot</a></span><span class="op">(</span><span class="va">H2O_flux_res</span>, <span class="va">LGR_manID</span>, <span class="st">"H2O_ppm"</span>, shoulder<span class="op">=</span><span class="fl">20</span>, </span>
<span>                            <span class="va">plot.legend</span>, <span class="va">plot.display</span>, <span class="va">quality.check</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine plot lists into one list</span></span>
<span><span class="va">flux_plot.ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">CO2_flux_plots</span>, <span class="va">CH4_flux_plots</span>, <span class="va">H2O_flux_plots</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save plots to pdf</span></span>
<span><span class="fu"><a href="reference/flux2pdf.html">flux2pdf</a></span><span class="op">(</span><span class="va">flux_plot.ls</span>, outfile <span class="op">=</span> <span class="st">"demo.results.pdf"</span><span class="op">)</span></span></code></pre></div>
<p>Here is an example of how the plots are saved as pdf:</p>
<p><img src="reference/figures/demo.results_Page_4.png"></p>
<p>You can then save the results as RData or in an Excel sheet to further process the results.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html" class="external-link">openxlsx</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save RData</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">CO2_flux_res</span>, file <span class="op">=</span> <span class="st">"CO2_flux_res.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">CH4_flux_res</span>, file <span class="op">=</span> <span class="st">"CH4_flux_res.RData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">H2O_flux_res</span>, file <span class="op">=</span> <span class="st">"H2O_flux_res.RData"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save to Excel</span></span>
<span><span class="fu">write.xlsx</span><span class="op">(</span><span class="va">CO2_flux_res</span>, file <span class="op">=</span> <span class="st">"CO2_flux_res.xlsx"</span><span class="op">)</span></span>
<span><span class="fu">write.xlsx</span><span class="op">(</span><span class="va">CH4_flux_res</span>, file <span class="op">=</span> <span class="st">"CH4_flux_res.xlsx"</span><span class="op">)</span></span>
<span><span class="fu">write.xlsx</span><span class="op">(</span><span class="va">H2O_flux_res</span>, file <span class="op">=</span> <span class="st">"H2O_flux_res.xlsx"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="troubleshoot-problems-with-install_github">Troubleshoot problems with <code>install_github()</code>
<a class="anchor" aria-label="anchor" href="#troubleshoot-problems-with-install_github"></a>
</h2>
<div class="section level3">
<h3 id="warning-package-is-in-use-and-will-not-be-installed">Warning: package is in use and will not be installed<a class="anchor" aria-label="anchor" href="#warning-package-is-in-use-and-will-not-be-installed"></a>
</h3>
<p>If you get this warning while trying to install an R package from GitHub:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning: package ‚ÄògoFlux‚Äô is in use and will not be installed</span></span></code></pre></div>
<p>This error means that the package is loaded. Before re-installing the package, you must first detach it:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/detach.html" class="external-link">detach</a></span><span class="op">(</span><span class="st">"package:goFlux"</span>, unload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If this does not solve the problem, restart your session and try again.</p>
<hr>
</div>
<div class="section level3">
<h3 id="error-api-rate-limit-exceeded">Error: API rate limit exceeded<a class="anchor" aria-label="anchor" href="#error-api-rate-limit-exceeded"></a>
</h3>
<p>If you get this error while trying to install an R package from GitHub:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Error: Failed to install 'goFlux' from GitHub:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   HTTP error 403.</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   API rate limit exceeded for xxx.xxx.xxx.x (But here's the good news: Authenticated requests get a higher rate limit. Check out the documentation for more details.)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Rate limit remaining: 0/60</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">##   Rate limit reset at: 2023-10-16 09:08:07 UTC</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   To increase your GitHub API rate limit</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   - Use `usethis::create_github_token()` to create a Personal Access Token.</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="do">##   - Use `usethis::edit_r_environ()` and add the token as `GITHUB_PAT`.</span></span></code></pre></div>
<div class="section level4">
<h4 id="step-1-set-up-a-github-account">Step 1: Set up a GitHub account<a class="anchor" aria-label="anchor" href="#step-1-set-up-a-github-account"></a>
</h4>
<p><strong>Go to <a href="https://github.com/join" class="external-link uri">https://github.com/join</a> .</strong></p>
<ol style="list-style-type: decimal">
<li><p>Type a user name, your email address, and a password.</p></li>
<li><p>Choose Sign up for GitHub, and then follow the instructions.</p></li>
</ol>
</div>
<div class="section level4">
<h4 id="step-2-create-a-github-token">Step 2: Create a GitHub token<a class="anchor" aria-label="anchor" href="#step-2-create-a-github-token"></a>
</h4>
<p>Run in R:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu">create_github_token</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>On pop-up website, generate and copy your token.</p>
</div>
<div class="section level4">
<h4 id="step-3-set-your-github-pat-from-r">Step 3: Set your GitHub PAT from R<a class="anchor" aria-label="anchor" href="#step-3-set-your-github-pat-from-r"></a>
</h4>
<p>Run in R with your own token generated in step 2:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">credentials</span><span class="fu">::</span><span class="fu">set_github_pat</span><span class="op">(</span><span class="st">"YourTokeninStep2"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="community-guidelines">Community Guidelines<a class="anchor" aria-label="anchor" href="#community-guidelines"></a>
</h2>
<p>Authors: Karelle Rheault and Klaus Steenberg Larsen</p>
<p>To report problems, seek support or contribute to the package, please contact the maintainer, Karelle Rheault (<a href="mailto:karh@ign.ku.dk" class="email">karh@ign.ku.dk</a>). Suggestions for new features or improvements are always welcome.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2" class="external-link">GPL-2</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing goFlux</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Karelle Rheault <br><small class="roles"> Maintainer, author, data contributor </small>  </li>
<li>Klaus Steenberg Larsen <br><small class="roles"> Author, thesis advisor </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Karelle Rheault, Klaus Steenberg Larsen.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
